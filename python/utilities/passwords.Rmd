---
title: '<font size="5">Utilities in Python:</font><br>Password Management'
output:
    html_document:
        theme: paper
        highlight: textmate
        number_sections: true
        toc: true
---

<font size="3">

[⇦ Back](../../python.html)

Python can help you generate and store passwords in a cryptographically safe way, which is very useful for designing apps and programmes or just generally keeping your accounts secure.

The Wrong Way to Do It
======================
What you don't want is to have a plain text file called "passwords.txt" or something stored on your computer. It would be obvious to a human what it is!

```{python}
passwords = []
with open('passwords.txt') as file:
    for line in file:
        passwords.append(line)
print(passwords[0])
```

passpy
======
bfrascher's **passpy** is a password manager that can be used on any operating system from the terminal or with Python. It is built on top of a programme called **pass** from ZX2C4 which in turn uses **GNU Privacy Guard** (GnuPG or GPG).

passpy saves your passwords in GPG-encrypted files on your computer. As well as being safer it also makes it possible to use git which can help you:

- Version control your passwords
- Sync your passwords across multiple computers
- Back them up in a cloud repository

Find out more:

- passpy: https://github.com/bfrascher/passpy and https://passpy.readthedocs.io/en/latest/
- pass: https://www.passwordstore.org/
- GnuPG: https://gnupg.org/

A useful StackExchange page: https://unix.stackexchange.com/questions/53912/i-try-to-add-passwords-to-the-pass-password-manager-but-my-attempts-fail-with

Installation
------------
- Install the passpy Python package from the terminal with `pip3 install passpy`
- GnuPG comes pre-installed on some OSs, so check if you already have it with `gpg --version`. If you don't have it, install it from here: https://gnupg.org/download/index.html
- Install gpg2 from the terminal with `sudo apt-get install gnupg2 -y`
- Install pass from the terminal with `sudo apt install pass`

Setup
-----
- Create a **GPG public key** with `gpg --gen-key`. Follow the prompts to set up a user ID.
    - Your public key will be printed to the console during this process, but if you want to view your key again in the future you can use `gpg --list-keys`
- Using the **pass** programme, initialise a **password store** (ie a folder in which your encrypted password files will be stored) with `pass init <key>` where &lt;key&gt; is your GPG public key that you found in the previous step. By default, this will create your password store folder at `~/.password-store/` although you can change this (indeed, you can have multiple password store folders)

Usage
-----
Now that you've set up the **GPG** and the **pass** components of your password manager, you can interact with it using **passpy**:

### CLI
From the terminal, you can use the following commands:

| Command | Effect |
|---------|--------|
| `passpy insert <key>` | Add a new password. It will be saved under the name &lt;key&gt; (in other words, the 'key' is the *name* of your password, not the password itself). |
| `passpy insert <folder>/<key>` | Add a new password saved in a sub-folder called &lt;folder&gt;. In general, all keys can be inside folders. |
| `passpy generate <key> <n>` | Generate a new password of length &lt;n&gt; and save it under the name &lt;key&gt; |
| `passpy rm <key>` | Delete a password |
| `passpy show` | Print the folder hierarchy of the default password store (which is located at `~/.password-store/`) |
| `passpy show <path>` | Print the folder hierarchy of the password store located at &lt;path&gt; |
| `passpy show <key>` | Print the password that is saved under the name &lt;key&gt; |
| `passpy show -c <key>` | Copy password to clipboard |

### Script
Assuming you've created a password called "example" (`passpy insert example`) in the password store that is in the default location (`~/.password-store`) you can access it from within a Python script with the following:

```{python}
import passpy

store = passpy.Store()
example = store.get_key('example')
print(example)
```

The `store_dir` keyword argument can be used to specify an exact password store:

```{python}
store = passpy.Store(store_dir='~/.password-store')
example = store.get_key('example')
print(example)
```

Add version control
-------------------
Turn your password store into a git repository by cd'ing into the password store folder in the terminal and running `git init`. From here, you can do all the more advanced git operations like connecting to a remote and cloning it on any other computers you have.

secrets
=======
`secrets` is a built-in module in Python 3.6 onwards. According to the documentation it "is used for generating cryptographically strong random numbers suitable for managing data such as passwords, account authentication, security tokens, and related secrets." - https://docs.python.org/3/library/secrets.html

So `secrets` can be used to *generate* passwords and `passpy` can be used to *store* passwords.

URL-safe strings
----------------
Generate a random text string that can, for example, be used by apps to create hard-to-guess URLs for doing password resets:

```{python}
import secrets

token = secrets.token_urlsafe()
print(token)
```

Generate a URL-safe string that is a custom number of bytes in length:

```{python}
token = secrets.token_urlsafe(10)
print(token)
```

XKCD-style passwords
--------------------
Strong, yet easy-to-remember passwords such as suggested by XKCD (https://xkcd.com/936/) can be generated by using a list of words. On standard Linux operating systems, the system dictionary file located at `/usr/share/dict/words` can be used. On other operating systems, you will need to use your own dictionary file or list of words.

```{python}
with open('/usr/share/dict/words') as f:
    words = [word.strip() for word in f]
    password = ' '.join(secrets.choice(words) for i in range(4))
print(password)
```

Generic strong passwords
------------------------
Often when websites require strong passwords they want something that contains:

- Alphanumerics (numbers and letters)
- At least ten characters
- At least one lowercase character
- At least one uppercase character
- At least one special character
- At least two digits

Here's a snippet that will do that:

```{python}
import string

alphabet = string.ascii_letters + string.digits + string.punctuation
while True:
    password = ''.join(secrets.choice(alphabet) for i in range(10))
    if (
        any(c.islower() for c in password) and
        any(c.isupper() for c in password) and
        any(c in string.punctuation for c in password) and
        sum(c.isdigit() for c in password) >= 3
    ):
        break
print(password)
```

[⇦ Back](../../python.html)

</font>
